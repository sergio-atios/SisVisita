<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limpar Cache - SisVisita</title>
    <style>
        body {
            font-family: system-ui;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .card {
            background: rgba(30,41,59,0.9);
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            text-align: center;
        }
        button {
            background: #ec4899;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 0.5rem;
        }
        button:hover {
            background: #db2777;
        }
        button:active {
            transform: scale(0.98);
        }
        .status {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 0.5rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîÑ Limpar Cache</h1>
        <p>Se o SisVisita n√£o est√° atualizando, use este utilit√°rio para for√ßar a atualiza√ß√£o.</p>
        
        <div style="margin: 2rem 0;">
            <button onclick="limparTudo()">üóëÔ∏è Limpar TUDO</button>
            <button onclick="limparCache()">üîÑ Limpar apenas Cache</button>
            <button onclick="limparServiceWorker()">‚öôÔ∏è Limpar Service Worker</button>
        </div>
        
        <div id="status" class="status">
            Aguardando a√ß√£o...
        </div>
    </div>

    <script>
        const status = document.getElementById('status');

        async function limparTudo() {
            status.innerHTML = 'üîÑ Limpando tudo...';
            
            try {
                // 1. Limpar localStorage
                localStorage.clear();
                status.innerHTML += '<br>‚úÖ localStorage limpo';
                
                // 2. Limpar todos os caches
                const cacheNames = await caches.keys();
                for (const name of cacheNames) {
                    await caches.delete(name);
                    status.innerHTML += `<br>‚úÖ Cache deletado: ${name}`;
                }
                
                // 3. Desregistrar service workers
                const registrations = await navigator.serviceWorker.getRegistrations();
                for (const registration of registrations) {
                    await registration.unregister();
                    status.innerHTML += '<br>‚úÖ Service Worker desregistrado';
                }
                
                status.innerHTML += '<br><br><strong>‚úÖ TUDO LIMPO!</strong>';
                status.innerHTML += '<br><br>‚è≥ Recarregando em 3 segundos...';
                
                setTimeout(() => {
                    window.location.href = './index.html';
                }, 3000);
                
            } catch (error) {
                status.innerHTML += `<br>‚ùå Erro: ${error.message}`;
            }
        }

        async function limparCache() {
            status.innerHTML = 'üîÑ Limpando cache...';
            
            try {
                const cacheNames = await caches.keys();
                for (const name of cacheNames) {
                    await caches.delete(name);
                    status.innerHTML += `<br>‚úÖ Deletado: ${name}`;
                }
                
                status.innerHTML += '<br><br>‚úÖ Cache limpo!';
                status.innerHTML += '<br>‚è≥ Recarregando...';
                
                setTimeout(() => window.location.reload(), 2000);
                
            } catch (error) {
                status.innerHTML += `<br>‚ùå Erro: ${error.message}`;
            }
        }

        async function limparServiceWorker() {
            status.innerHTML = 'üîÑ Desregistrando Service Workers...';
            
            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                
                if (registrations.length === 0) {
                    status.innerHTML = '‚ö†Ô∏è Nenhum Service Worker registrado';
                    return;
                }
                
                for (const registration of registrations) {
                    await registration.unregister();
                    status.innerHTML += '<br>‚úÖ Service Worker removido';
                }
                
                status.innerHTML += '<br><br>‚úÖ Conclu√≠do!';
                status.innerHTML += '<br>‚è≥ Recarregando...';
                
                setTimeout(() => window.location.reload(), 2000);
                
            } catch (error) {
                status.innerHTML += `<br>‚ùå Erro: ${error.message}`;
            }
        }

        // Mostrar informa√ß√µes ao carregar
        window.addEventListener('load', async () => {
            let info = '‚ÑπÔ∏è Informa√ß√µes:<br>';
            
            // Caches
            const cacheNames = await caches.keys();
            info += `<br>üì¶ Caches: ${cacheNames.length}`;
            cacheNames.forEach(name => {
                info += `<br>&nbsp;&nbsp;‚Ä¢ ${name}`;
            });
            
            // Service Workers
            const registrations = await navigator.serviceWorker.getRegistrations();
            info += `<br><br>‚öôÔ∏è Service Workers: ${registrations.length}`;
            
            // localStorage
            info += `<br><br>üíæ localStorage itens: ${localStorage.length}`;
            
            status.innerHTML = info;
        });
    </script>
</body>
</html>
